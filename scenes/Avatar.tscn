[gd_scene load_steps=5 format=1]

[ext_resource path="res://icon.png" type="Texture" id=1]

[sub_resource type="ConvexPolygonShape2D" id=1]

custom_solver_bias = 0.0
points = Vector2Array( 32, -32, 32, 32, -32, 32, -32, -32 )

[sub_resource type="GDScript" id=2]

script/source = "extends KinematicBody2D

var bulletTscn = preload(\"res://scenes/Bullet.tscn\")
# class member variables go here, for example:
const shoot_speed = 500
const fire_rate = 1 # lets say in ms

const velocity = 350

var fire_ready = 0

func _ready():
	set_process_input(true)
	set_fixed_process(true)

func _fixed_process(delta):
	
	self.fire_ready -= delta
	if self.fire_ready < 0:
		self.fire_ready = 0
	
	var vect = Vector2(0,0)
	
	if Input.is_action_pressed(\"action_shoot\"):
		_shoot_arrow(delta)
		
	if Input.is_action_pressed(\"ui_up\") :
		vect.y = -1
	if Input.is_action_pressed(\"ui_down\") :
		vect.y = 1
	if Input.is_action_pressed(\"ui_right\") :
		vect.x = 1
	if Input.is_action_pressed(\"ui_left\") :
		vect.x = -1
	
	var motion = vect.normalized() * velocity * delta
	self.move(motion)
	
	if (is_colliding()):
		var n = get_collision_normal()
		motion = n.slide(motion)
		vect = n.slide(vect)
		move(motion)

func _shoot_arrow(delta):
	
	if self.fire_ready == 0:
		self.fire_ready = fire_rate
		var new_arrow = bulletTscn.instance()
		var arrow_rotation = get_angle_to(get_global_mouse_pos()) + self.get_rot()
		new_arrow.set_rot(arrow_rotation)
		new_arrow.set_global_pos(self.get_global_pos())
		get_parent().get_node(\"BulletHolder\").add_child(new_arrow)
		new_arrow.init_bullet( ( get_global_mouse_pos() - self.get_global_pos() ).normalized() * shoot_speed )

"

[sub_resource type="Animation" id=3]

length = 0.25
loop = true
step = 0.14
tracks/0/type = "value"
tracks/0/path = NodePath("Sprite:visibility/visible")
tracks/0/interp = 1
tracks/0/imported = false
tracks/0/keys = {
"times": FloatArray( 0, 0.13, 0.25 ),
"transitions": FloatArray( 1, 1, 1 ),
"update": 1,
"values": [ true, false, true ]
}

[node name="Avatar" type="KinematicBody2D"]

input/pickable = false
shapes/0/shape = SubResource( 1 )
shapes/0/transform = Matrix32( 1, 0, 0, 1, 0, 0 )
shapes/0/trigger = false
collision/layers = 1
collision/mask = 1
collision/margin = 0.08
script/script = SubResource( 2 )

[node name="Sprite" type="Sprite" parent="."]

texture = ExtResource( 1 )

[node name="CollisionPolygon2D" type="CollisionPolygon2D" parent="."]

build_mode = 0
polygon = Vector2Array( -32, -32, -32, 32, 32, 32, 32, -32 )
shape_range = Vector2( 0, 0 )
trigger = false

[node name="AnimationPlayer" type="AnimationPlayer" parent="."]

playback/process_mode = 1
playback/default_blend_time = 0.0
root/root = NodePath("..")
anims/take_damage = SubResource( 3 )
playback/active = true
playback/speed = 1.0
blend_times = [  ]
autoplay = ""


